var Battleship=Battleship||{};Battleship.GameState=Battleship.GameState||{},Battleship.GameState.SHOT_DELAY=200,Battleship.GameState.BULLET_SPEED=850,Battleship.GameState.NUMBER_OF_BULLETS=20,Battleship.GameState.BOARD_COLS,Battleship.GameState.BOARD_ROWS,Battleship.GameState.CELL_SIZE=64,Battleship.GameState.CELL_SPACING=2,Battleship.GameState.CELL_SIZE_SPACED=Battleship.GameState.CELL_SIZE+Battleship.GameState.CELL_SPACING,Battleship.GameState.lastBulletShotAt=void 0,Battleship.GameState.cells,Battleship.GameState.selectedCell=null,Battleship.GameState.selectedCellStartPos={x:0,y:0},Battleship.GameState.init=function(){this.game.physics.startSystem(Phaser.Physics.ARCADE)},Battleship.GameState.preload=function(){this.load.image("bullet","img/assets/gfx/rocket.png"),this.load.image("player","img/assets/gfx/bullet.png"),this.load.image("enemy","img/assets/gfx/player.png"),this.load.image("ground","img/assets/gfx/ground.png"),this.load.image("cell","img/assets/gfx/cell.png"),this.load.spritesheet("explosion","img/assets/gfx/explosion.png",128,128)},Battleship.GameState.create=function(){this.game.stage.backgroundColor="#4488cc",this.positionData(),this.spawnBoard(),this.gun=this.game.add.sprite(this.game.width/2,this.game.height-10,"player"),this.gun.anchor.setTo(.5,.5),this.bulletPool=this.game.add.group();for(var t=0;t<this.NUMBER_OF_BULLETS;t++){var e=this.game.add.sprite(0,0,"bullet");this.bulletPool.add(e),e.anchor.setTo(.5,.5),this.game.physics.enable(e,Phaser.Physics.ARCADE),e.kill()}this.game.input.activePointer.x=this.game.width/2,this.game.input.activePointer.y=this.game.height/2,this.explosionGroup=this.game.add.group()},Battleship.GameState.enemyHit=function(t){t.marker=0,t.hasEnemy=!1,console.log("enemy found!")},Battleship.GameState.miss=function(t){0!==t.marker||t.hasEnemy||console.log("nothing here")},Battleship.GameState.shootBullet=function(){if(void 0===this.lastBulletShotAt&&(this.lastBulletShotAt=0),!(this.game.time.now-this.lastBulletShotAt<this.SHOT_DELAY)){this.lastBulletShotAt=this.game.time.now;var t=this.bulletPool.getFirstDead();null!==t&&void 0!==t&&(t.revive(),t.checkWorldBounds=!0,t.outOfBoundsKill=!0,t.reset(this.gun.x,this.gun.y),t.rotation=this.gun.rotation,t.body.velocity.x=Math.cos(t.rotation)*this.BULLET_SPEED,t.body.velocity.y=Math.sin(t.rotation)*this.BULLET_SPEED)}},Battleship.GameState.update=function(){this.game.physics.arcade.collide(this.bulletPool,this.cells,function(t,e){this.getExplosion(e,e.posX,e.posY),console.log("cell x: "+e.posX+" cell y: "+e.posY),t.kill(),e.body.enable&&(e.body.enable=!1),this.enemyHit(e)},null,this),this.gun.rotation=this.game.physics.arcade.angleToPointer(this.gun)},Battleship.GameState.getExplosion=function(t,e,a){var s=this.explosionGroup.getFirstDead();if(null===s){s=this.game.add.sprite(0,0,"explosion"),s.anchor.setTo(.5,.5);s.animations.add("boom",[0,0,1,2,3],60,!1).killOnComplete=!0,this.explosionGroup.add(s)}return s.revive(),s.x=e,s.y=a,s.angle=this.game.rnd.integerInRange(0,360),s.animations.play("boom"),s},Battleship.GameState.positionData=function(){this.matrix=[[0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0],[0,1,0,0,1,0,1,0,0,0],[0,0,0,0,1,1,1,0,0,0],[0,0,0,0,1,0,1,0,0,0]]},Battleship.GameState.spawnBoard=function(){this.BOARD_COLS=Math.floor(this.game.world.width/this.CELL_SIZE_SPACED),this.BOARD_ROWS=Math.floor(this.game.world.height/this.CELL_SIZE_SPACED-1),this.cells=this.game.add.group();for(var t=0;t<this.BOARD_COLS;t++)for(var e=0;e<this.BOARD_ROWS;e++){var a=this.cells.create(t*this.CELL_SIZE_SPACED+this.CELL_SIZE_SPACED/2+2,e*this.CELL_SIZE_SPACED+this.CELL_SIZE/2+2,"cell");a.anchor.setTo(.5,.5),a.name="cell: "+t.toString()+"x"+e.toString(),a.inputEnabled=!0,a.marker=this.matrix[e][t],a.posX=a.x,a.posY=a.y,a.hasEnemy=a.marker>0,a.events.onInputDown.add(this.selectCell,this),a.events.onInputUp.add(this.releaseCell,this)}},Battleship.GameState.selectCell=function(t){this.shootBullet(),t.hasEnemy&&(this.game.physics.enable(t,Phaser.Physics.ARCADE),t.body.immovable=!0,t.body.allowGravity=!1,console.log("found enemy"))},Battleship.GameState.releaseCell=function(t){},Battleship.game=new Phaser.Game(664,730,Phaser.AUTO,"game-canvas"),Battleship.game.state.add("GameState",Battleship.GameState),Battleship.game.state.start("GameState");